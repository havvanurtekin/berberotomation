{% extends "base.html" %}
{% block content %}
<h2>Randevu Takvimi</h2>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Tarih</th>
            <th>Başlangıç</th>
            <th>Bitiş</th>
            <th>Hizmet</th>
            <th>Çalışan</th>
            <th>Onay</th>
        </tr>
    </thead>
    <tbody>
        {% for appt in appointments %}
        <tr>
            <td>{{ appt.date }}</td>
            <td>{{ appt.start_time }}</td>
            <td>{{ appt.end_time }}</td>
            <td>{{ appt.service.name }}</td>
            <td>{{ appt.employee }}</td>
            <td>
                    {% if not appt.is_confirmed %}
                    <form method="post" action="{% url 'approve_appointment' appt.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">Onayla</button>
                    </form>

                    <button type="button" onclick="showRejectForm({{ appt.pk }})" class="btn btn-danger">Reddet</button>
                    <form method="post" action="{% url 'reject_appointment' appt.pk %}" id="reject-form-{{ appt.pk }}" style="display:none;">
                        {% csrf_token %}
                        <input type="text" name="rejection_note" placeholder="Açıklama girin">
                        <button type="submit" class="btn btn-danger">Gönder</button>
                    </form>
                    {% else %}
                    Onaylandı
                    {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Henüz randevunuz yok.</td></tr>
        {% endfor %}
    </tbody>
</table>
<script>
function showRejectForm(pk){
    var form = document.getElementById('reject-form-' + pk);
    form.style.display = 'block';
}
</script>
{% endblock %}
