{% extends "base.html" %}
{% block title %}Randevu Takvimi{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow-lg border-0 rounded">
            <div class="card-header bg-dark text-white text-center">
                <h4>ðŸ“… Randevu Takvimi</h4>
            </div>
            <div class="card-body p-4">
                <table class="table table-hover align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Tarih</th>
                            <th>BaÅŸlangÄ±Ã§</th>
                            <th>BitiÅŸ</th>
                            <th>Hizmet</th>
                            <th>Ã‡alÄ±ÅŸan</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appt in appointments %}
                        <tr>
                            <td>{{ appt.date }}</td>
                            <td>{{ appt.start_time }}</td>
                            <td>{{ appt.end_time }}</td>
                            <td>{{ appt.service.name }}</td>
                            <td>{{ appt.employee }}</td>
                            <td>
                                {% if appt.status == "pending" %}
                                    <span class="badge bg-warning text-dark">Bekliyor</span>
                                    <form method="post" action="{% url 'approve_appointment' appt.pk %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-success">Onayla</button>
                                    </form>
                                    <button type="button" onclick="showRejectForm({{ appt.pk }})" class="btn btn-sm btn-danger">Reddet</button>
                                    <form method="post" action="{% url 'reject_appointment' appt.pk %}" id="reject-form-{{ appt.pk }}" style="display:none;" class="mt-2">
                                        {% csrf_token %}
                                        <input type="text" name="rejection_note" class="form-control form-control-sm mb-2" placeholder="AÃ§Ä±klama girin">
                                        <button type="submit" class="btn btn-sm btn-danger">GÃ¶nder</button>
                                    </form>
                                {% elif appt.status == "confirmed" %}
                                    <span class="badge bg-success">OnaylandÄ±</span>
                                {% elif appt.status == "rejected" %}
                                    <span class="badge bg-danger">Reddedildi</span>
                                    <small class="text-muted">({{ appt.rejection_note }})</small>
                                {% elif appt.status == "cancelled" %}
                                    <span class="badge bg-secondary">Ä°ptal Edildi</span>
                                {% elif appt.status == "no_show" %}
                                    <span class="badge bg-dark">Gelmedi</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center text-muted">HenÃ¼z randevunuz yok.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- BoÅŸ zamanlarÄ± gÃ¶ster -->
                {% if free_slots %}
                <h5 class="mt-4">ðŸ•’ BoÅŸ Zamanlar</h5>
                <ul class="list-group">
                    {% for slot in free_slots %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ slot.date }} {{ slot.start_time }} - {{ slot.end_time }}
                            <span class="badge bg-info text-dark">MÃ¼sait</span>
                        </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function showRejectForm(pk){
    var form = document.getElementById('reject-form-' + pk);
    form.style.display = 'block';
}
</script>
{% endblock %}
